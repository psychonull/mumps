/*! 
* LD28 - mumps: fear of contagion - v1.0.0
* Copyright (c) 2013 PsychoNull @psychonull 
*  
*/ 

!function(a){"use strict";var b,c,d,e,f,g={".js":[],".json":[],".css":[],".html":[]};return e=function(a){var b=new Error("Could not find module '"+a+"'");return b.code="MODULE_NOT_FOUND",b},f=function(a,b,c){var d,e;if("function"==typeof a[b+c])return b+c;for(d=0;e=g[c][d];++d)if("function"==typeof a[b+e])return b+e;return null},b=function(a,d,g,h,i){var j,k,l,m,n,o;for(g=g.split(/[\\/]/),j=g.pop(),("."===j||".."===j)&&(g.push(j),j="");null!=(k=g.shift());)if(k&&"."!==k&&(".."===k?a=d.pop():(d.push(a),a=a[k]),!a))throw e(h);if(j&&"function"!=typeof a[j]&&(o=f(a,j,".js"),o||(o=f(a,j,".json")),o||(o=f(a,j,".css")),o||(o=f(a,j,".html")),o?j=o:2!==i&&"object"==typeof a[j]&&(d.push(a),a=a[j],j="")),!j)return 1!==i&&a[":mainpath:"]?b(a,d,a[":mainpath:"],h,1):b(a,d,"index",h,2);if(n=a[j],!n)throw e(h);return n.hasOwnProperty("module")?n.module.exports:(l={},n.module=m={exports:l},n.call(l,l,m,c(a,d)),m.exports)},d=function(c,d,f){var g,h=f,i=f.charAt(0),j=0;if("/"===i)h=h.slice(1),c=a["/"],d=[];else if("."!==i){if(g=h.split("/",1)[0],c=a[g],!c)throw e(f);d=[],h=h.slice(g.length+1),h||(h=c[":mainpath:"],h?j=1:(h="index",j=2))}return b(c,d,h,f,j)},c=function(a,b){return function(c){return d(a,[].concat(b),c)}},c(a,[])}({ld28:{client:{game:{"builder.js":function(a,b,c){b.exports=function(a){function b(){l.size={width:i.width()-j,height:i.height()-j},mumps.settings.worldSize.w<l.size.width&&(l.size.width=mumps.settings.worldSize.w),mumps.settings.worldSize.h<l.size.height&&(l.size.h=mumps.settings.worldSize.h),$(".game-ctn").add(".main").add("#cinema").width(l.size.width).height(l.size.height),l.camera.set("size",{width:l.size.width,height:l.size.height}),g.width=l.size.width,g.height=l.size.height,h.width=l.size.width,h.height=l.size.height}function d(){for(var b=f[a].npcs,d=0;d<b.length;d++)c("./entities/person")(l,b[d])}function e(){l.paused?l.start():l.stop()}var f=c("./data/index.js"),g=document.getElementById("game-viewport"),h=document.getElementById("game-static"),i=$(document),j=10,k={width:i.width()-j,height:i.height()-j};mumps.settings.worldSize=f[a].worldSize;var l=oaky.createGame({size:k,canvas:g,canvasStatic:h});l.level=a,l.camera=c("./entities/camera")(l),$("body").css("overflow","hidden"),b();var m=c("./entities/person")(l,f[a].player);m=c("./entities/player")(l,m,f[a].player),l.player=m,l.walkLine=c("./entities/walkLine")(l),l.objetive=c("./entities/objetive")(l,f[a].objetive),d(),c("./entities/infectionBar")(l),c("./systems")(l);var n=new mumps.Controls({container:h});return l.controls=n,n.enable(),n.on("pause",e).on("slide:start",function(a){l.walkLine.set("walkStartingPoint",{x:a.x+l.camera.get("position").x,y:a.y+l.camera.get("position").y}),l.walkLine.set("target",{x:a.x+l.camera.get("position").x,y:a.y+l.camera.get("position").y})}).on("slide",function(a){l.walkLine.has("position")&&l.walkLine.set("target",{x:a.x+l.camera.get("position").x,y:a.y+l.camera.get("position").y})}).on("slide:end",function(){l.walkLine.has("position")&&l.walkLine.has("target")&&l.player.set("target",l.walkLine.get("target")),l.walkLine.remove("walkStartingPoint"),l.walkLine.remove("position")}),l.start(),mumps.settings.debug&&c("./debug").activate(l),l.on("after:destroy",function(){n.off()}),l}},controls:{"mouse.js":function(a,b){function c(a){var b=$(a.target).offset();return{x:a.pageX-b.left,y:a.pageY-b.top}}var d=b.exports=function(a){this.container=a.container||window.document,this.events={"slide:start":null,slide:null,"slide:end":null},this.enabled=!1,this.onSlide=this._onSlide.bind(this),$(this.container).on("mousemove",this.onSlide),this.onSlideStart=this._onSlideStart.bind(this),$(this.container).on("mousedown",this.onSlideStart),this.onSlideEnd=this._onSlideEnd.bind(this),$(this.container).on("mouseup",this.onSlideEnd),this.propelling=!1};d.prototype.enable=function(){return this.enabled=!0,this},d.prototype.disable=function(){return this.enabled=!1,this},d.prototype.on=function(a,b){return this.events[a]||(this.events[a]=[]),this.events[a].push(b),this},d.prototype.off=function(a){if(a)return this.events[a]||(this.events[a].length=0),this;for(var b in this.events)this.events.hasOwnProperty(b)&&(this.events[b].length=0)},d.prototype._onSlide=function(a){this.enabled&&a.which&&_.each(this.events.slide,function(b){b(c(a))})},d.prototype._onSlideStart=function(a){this.enabled&&_.each(this.events["slide:start"],function(b){b(c(a))})},d.prototype._onSlideEnd=function(a){this.enabled&&_.each(this.events["slide:end"],function(b){b(c(a))})}}},data:{"index.js":function(a,b,c){b.exports={1:c("./level1"),2:c("./level2"),3:c("./level3"),4:c("./level4"),5:c("./level5")}},"level1.js":function(a,b){b.exports={worldSize:{w:1e3,h:1400},spriteSheet:"bar",obstacles:[{x:0,y:0,w:172,h:600,type:"barra"},{x:0,y:762,w:339,h:109,type:"stand_table"},{x:0,y:1047,w:253,h:353},{x:0,y:1366,w:460,h:34},{x:648,y:1221,w:352,h:179},{x:738,y:846,w:262,h:144,type:"table"},{x:733,y:493,w:267,h:149,type:"table"},{x:824,y:0,w:176,h:240,type:"table"},{x:835,y:60,w:105,h:120,type:"letter"},{x:315,y:211,w:347,h:149,type:"table"}],objetive:{x:855,y:180,r:120},npcs:[{x:531,y:934,speed:3,boundary:{min:{x:390,y:800},max:{x:781,y:1060}},npc:{rest:[1,3]}},{x:265,y:100,skin:1},{x:319,y:500,skin:2},{x:830,y:980,npc:!1,angle:-1.5,skin:3},{x:824,y:752,npc:!1,angle:1.5,skin:4},{x:50,y:850,npc:!1,angle:-1.5,skin:5},{x:50,y:670,npc:!1,angle:1.5,skin:6}],player:{x:520,y:1250,angle:-1.7,speed:5}}},"level2.js":function(a,b){b.exports={worldSize:{w:1e3,h:1400},spriteSheet:"bar",obstacles:[{x:0,y:0,w:172,h:600,type:"barra"},{x:0,y:762,w:339,h:109,type:"stand_table"},{x:0,y:1047,w:253,h:353},{x:0,y:1366,w:460,h:34},{x:648,y:1221,w:352,h:179},{x:738,y:846,w:262,h:144,type:"table"},{x:733,y:493,w:267,h:149,type:"table"},{x:824,y:0,w:176,h:240,type:"table"},{x:315,y:211,w:347,h:149,type:"table"}],objetive:{x:550,y:1345,r:120},npcs:[{x:531,y:934,speed:3,boundary:{min:{x:390,y:800},max:{x:781,y:1060}},npc:{rest:[1,3]},contagionFocus:{radius:150,power:.2},skin:4},{x:265,y:100,inmune:!0,skin:1},{x:319,y:500,inmune:!0,skin:2},{x:830,y:980,npc:!1,angle:200,skin:3},{x:824,y:752,npc:!1,angle:90,skin:4},{x:50,y:880,boundary:{min:{x:20,y:800},max:{x:500,y:1060}},inmune:!0,skin:6},{x:50,y:670,npc:!1,angle:95,skin:5}],player:{x:815,y:230,speed:5,skin:3}}},"level3.js":function(a,b){var c={w:2e3,h:1e3};b.exports={worldSize:{w:c.w,h:c.h},spriteSheet:"street",background:"street_floor",obstacles:[{x:0,y:c.h-40,w:c.w,h:50},{x:0,y:0,w:450,h:140,type:"awning"},{x:1880,y:20,w:100,h:180,type:"fence"},{x:1880,y:270,w:100,h:180,type:"fence"},{x:1880,y:500,w:100,h:180,type:"fence"},{x:1880,y:750,w:100,h:180,type:"fence"},{x:600,y:200,w:429,h:171,type:"car"},{x:1164,y:696,w:283,h:186,type:"trash"},{x:600,y:696,w:200,h:70,type:"trash"}],npcs:[{x:1800,y:350,npc:!1,skin:1,inmune:!0,angle:3},{x:700,y:500,npc:{rest:[1,3]},skin:3,inmune:!0,speed:3},{x:400,y:700,npc:{rest:[5,8]},skin:2,inmune:!0,speed:10,contagionFocus:{radius:130,power:1}},{x:900,y:700,npc:{rest:[5,8]},skin:2,inmune:!0,speed:10,contagionFocus:{radius:130,power:1}},{x:1100,y:200,npc:{rest:[1,3]},skin:5,inmune:!0,speed:4,boundary:{min:{x:1e3,y:30},max:{x:1600,y:800}},contagionFocus:{radius:200,power:.4}},{x:1200,y:500,npc:{rest:[1,3]},skin:5,inmune:!0,speed:4,boundary:{min:{x:1e3,y:30},max:{x:1600,y:800}}},{x:1700,y:200,npc:{rest:[.5,6]},skin:5,speed:3,boundary:{min:{x:1300,y:30},max:{x:1800,y:300}},contagionFocus:{radius:200,power:.5}}],objetive:{x:1850,y:400,r:160},player:{x:160,y:250,speed:10}}},"level4.js":function(a,b){var c={w:2e3,h:1e3};b.exports={worldSize:{w:c.w,h:c.h},spriteSheet:"street",background:"street_floor",obstacles:[{x:0,y:c.h-40,w:c.w,h:50},{x:1615,y:850,w:450,h:140,type:"awning_upsidedown"},{x:10,y:20,w:100,h:180,type:"fence"},{x:10,y:270,w:100,h:180,type:"fence"},{x:10,y:500,w:100,h:180,type:"fence"},{x:10,y:750,w:100,h:180,type:"fence"},{x:382,y:334,w:429,h:171,type:"car"},{x:1112,y:552,w:283,h:186,type:"trash"},{x:1037,y:143,w:120,h:220,type:"trash"}],npcs:[{x:1800,y:350,boundary:{min:{x:1600,y:280},max:{x:2e3,y:1e3}},skin:3},{x:1271,y:355,npc:!1,contagionFocus:{radius:150,power:.3},angle:-.5,skin:2},{x:1365,y:158,skin:4},{x:550,y:210,npc:{rest:[10,20]},contagionFocus:{radius:250,power:.2},skin:1},{x:1280,y:80,npc:{rest:[2,5]},boundary:{min:{x:1100,y:30},max:{x:2e3,y:240}},skin:4},{x:672,y:695,boundary:{min:{x:532,y:501},max:{x:1031,y:764}},skin:5},{x:300,y:895,npc:{rest:[.5,3]},boundary:{min:{x:200,y:501},max:{x:1031,y:764}},contagionFocus:{radius:150,power:.6},speed:5,skin:3}],objetive:{x:1750,y:890,r:160},player:{x:160,y:250,speed:10}}},"level5.js":function(a,b){var c={w:2e3,h:3e3};b.exports={worldSize:{w:c.w,h:c.h},spriteSheet:"bar",obstacles:[{x:0,y:0,w:552,h:705},{x:180,y:670,w:190,h:50},{x:835,y:226,w:125,h:335,type:"stand_table_vertical"},{x:1150,y:226,w:125,h:335,type:"stand_table_vertical"},{x:1431,y:220,w:125,h:335,type:"stand_table_vertical"},{x:790,y:905,w:250,h:250,type:"table"},{x:1374,y:910,w:250,h:250,type:"table"},{x:790,y:1330,w:250,h:250,type:"table"},{x:1374,y:1330,w:250,h:250,type:"table"},{x:200,y:1160,w:190,h:380,type:"table_vertical"},{x:0,y:1720,w:c.w-366,h:392},{x:500,y:2650,w:125,h:335,type:"stand_table_vertical"},{x:500,y:2500,w:335,h:125,type:"stand_table"},{x:850,y:2500,w:335,h:125,type:"stand_table"},{x:1350,y:2120,w:250,h:250,type:"table"}],npcs:[{x:60,y:700,skin:5,npc:!1,contagionFocus:{radius:220,power:.1},angle:1.5},{x:400,y:700,skin:5,npc:!1,angle:1.5},{x:1e3,y:60,npc:{rest:[1,3]},contagionFocus:{radius:100,power:.3},skin:1},{x:1500,y:60,npc:{rest:[1,7]},skin:2},{x:650,y:300,npc:{rest:[1,3]},skin:5},{x:750,y:560,npc:{rest:[1,3]},skin:3},{x:1e3,y:750,npc:{rest:[1,3]},contagionFocus:{radius:150,power:.3},skin:1},{x:1250,y:560,npc:{rest:[1,3]},skin:5},{x:1500,y:750,npc:{rest:[1,3]},skin:4},{x:1700,y:560,npc:{rest:[1,3]},contagionFocus:{radius:150,power:.3},skin:3},{x:1500,y:1200,npc:{rest:[1,3]},contagionFocus:{radius:150,power:.3},skin:4},{x:1e3,y:1200,npc:{rest:[1,3]},skin:3},{x:600,y:1200,npc:{rest:[1,5]},contagionFocus:{radius:150,power:.3},skin:5},{x:550,y:1500,npc:{rest:[1,3]},skin:1},{x:70,y:1350,npc:{rest:[1,5]},skin:2},{x:1800,y:250,npc:{rest:[12,20]},skin:1},{x:1750,y:1800,boundary:{min:{x:1600,y:1600},max:{x:2e3,y:2300}},npc:{rest:[1,3]},contagionFocus:{radius:150,power:.2},skin:1},{x:1800,y:2e3,boundary:{min:{x:1600,y:1600},max:{x:2e3,y:2300}},npc:{rest:[1,5]},skin:1},{x:150,y:2250,boundary:{min:{x:1,y:2e3},max:{x:450,y:2600}},npc:{rest:[1,3]},contagionFocus:{radius:250,power:.5},skin:1},{x:700,y:2350,boundary:{min:{x:450,y:2e3},max:{x:1200,y:2600}},npc:{rest:[1,5]},contagionFocus:{radius:130,power:.3},skin:3},{x:1150,y:2200,boundary:{min:{x:600,y:2e3},max:{x:1400,y:2500}},npc:{rest:[1,3]},skin:5},{x:1250,y:2800,boundary:{min:{x:850,y:2500},max:{x:1800,y:3e3}},npc:{rest:[1,5]},skin:1},{x:1700,y:2600,boundary:{min:{x:1400,y:2300},max:{x:2e3,y:3e3}},npc:{rest:[1,5]},contagionFocus:{radius:250,power:.3},skin:5},{x:130,y:2650,npc:!1,skin:6,inmune:!0,angle:1},{x:270,y:2650,npc:!1,skin:2,inmune:!0,angle:-4},{x:130,y:2770,npc:!1,skin:4,inmune:!0,angle:-1},{x:270,y:2770,npc:!1,skin:4,inmune:!0,angle:-2}],objetive:{x:230,y:2780,r:200},player:{x:200,y:770,speed:7,angle:.5}}}},"debug.js":function(a,b){b.exports={activate:function(a){$("textarea").show(),a.controls.on("slide",function(a){var b={x:a.x+mumps._current.camera.get("position").x,y:a.y+mumps._current.camera.get("position").y};$("textarea").text(JSON.stringify(b))})}}},entities:{"camera.js":function(a,b){b.exports=function(a){var b=a.entities.make();return b.add("position",{x:0,y:0}),b.add("size",{width:a.size.width,height:a.size.height}),b.add("camera"),b.set("bg",{x:0,y:0}),b}},"infectionBar.js":function(a,b){b.exports=function(a){var b=a.entities.make();return b.add("position",{x:-50,y:a.size.height-230}),b.add("display",{type:"sprite",x:0,y:0,width:250,height:250,sheet:"hud",animation:"infection_bar1",index:0,loop:!1,frameTime:200}),b.add("playerStatus"),b.add("static"),b}},"objetive.js":function(a,b){b.exports=function(a,b){var c=a.entities.make();return c.add("position",_.pick(b,"x","y")),c.add("size",{width:10,height:10}),c.add("dynamic"),c.add("objetive"),c.add("collision",b.r||50),c}},"obstacle.js":function(a,b){b.exports=function(a,b){var c=a.entities.make();return c.add("position",{x:b.x,y:b.y}),c.add("size",{width:b.w,height:b.h}),c.add("scale",{x:1,y:1}),c.add("mass",1e3),c.add("boundary",{min:{x:0,y:0},max:{x:mumps.settings.worldSize.w,y:mumps.settings.worldSize.h}}),b.type&&b.spriteSheet?c.add("display",{type:"sprite",x:0,y:0,width:b.w,height:b.h,sheet:b.spriteSheet,animation:b.type,index:0}):c.add("display",{type:"rect",x:0,y:0,width:b.w,height:b.h,fill:"black"}),c.add("dynamic"),c.add("obstacle"),c.add("zindex",1),c}},"person.js":function(a,b){b.exports=function(a,b){var c=a.entities.make();b=_.defaults(b||{},{x:0,y:0,speed:mumps.settings.defaultPersonSpeed,angle:0,boundary:{min:{x:0,y:0},max:{x:mumps.settings.worldSize.w,y:mumps.settings.worldSize.h}},inmune:!1,skin:_.random(1,5)});var d=_.pick(b,"x","y");return c.add("position",d),c.add("velocity",{x:0,y:0}),c.add("speed",b.speed),c.add("size",{width:80,height:120}),c.add("angle",b.angle),c.add("scale",{x:1,y:1}),c.add("mass",.01),c.add("boundary",b.boundary),c.add("skin",b.skin),c.add("display",{type:"sprite",x:0,y:0,width:80,height:120,sheet:"person",animation:"idle_"+b.skin,index:0,loop:!0,frameTime:200}),c.add("collision",45),c.add("dynamic"),(b.npc||!_.has(b,"npc"))&&c.add("npc",_.defaults(b.npc||{},{rest:mumps.settings.defaultNPCRest})),c.add("person"),c.add("zindex",2),b.contagionFocus&&c.add("contagionFocus",b.contagionFocus),b.inmune&&c.add("inmune"),c}},"player.js":function(a,b){b.exports=function(a,b,c){b.add("position",{x:c.x||50,y:c.y||50}),b.add("boundary",{min:{x:0,y:0},max:{x:mumps.settings.worldSize.w,y:mumps.settings.worldSize.h}});var d=0;return b.get("display").fill="red",b.get("display").animation="idle_"+d,b.set("skin",d),b.add("dynamic"),b.add("player"),b.remove("npc"),b.add("zindex",4),b}},"walkLine.js":function(a,b){b.exports=function(a){var b=a.entities.make();return b.add("size","TODO: remove this"),b.add("display",{type:"line",color:"#F00",width:3,hidden:!1}),b.add("walkControl"),b.add("dynamic"),b.add("zindex",3),b}}},"helpers.js":function(a,b){b.exports={doBoxesCollide:function(a,b){var c=a.get("position"),d=b.get("position"),e=a.get("size"),f=b.get("size");return!(c.y+e.height<d.y||c.y>d.y+f.height||c.x+e.width<d.x||c.x>d.x+f.width)},circleRectangleCollide:function(a,b){var c=this.circleRectangleCollideDistance(a,b),d=c.x*c.x+c.y*c.y;return d<a.r*a.r},circleRectangleCollideDistance:function(a,b){function c(a,b,c){return Math.max(b,Math.min(c,a))}var d=c(a.x,b.x,b.x+b.width),e=c(a.y,b.y,b.y+b.height),f=a.x-d,g=a.y-e;return{x:f,y:g}},circlesCollide:function(a,b,c,d,e,f){var g=a-d,h=b-e,i=c+f;return i*i>=g*g+h*h},entitiesCollide:function(a,b){var c=this.getCenter(a),d=this.getCenter(b);c.r=a.get("collision"),d.r=b.get("collision");var e=c.x-d.x,f=c.y-d.y,g=c.r+d.r;return g*g>=e*e+f*f},isNear:function(a,b,c){var d=this.getCenter(a),e=this.getCenter(b),f=this.vectors.length(d,e);return c>f},aabbContainsSegment:function(a,b,c,d,e,f,g,h){if(e>=a&&e>=c||f>=b&&f>=d||a>=g&&c>=g||b>=h&&d>=h)return!1;var i=(d-b)/(c-a),j=i*(e-a)+b;if(j>f&&h>j)return!0;if(j=i*(g-a)+b,j>f&&h>j)return!0;var k=(f-b)/i+a;return k>e&&g>k?!0:(k=(h-b)/i+a,k>e&&g>k?!0:!1)},isPointInCircle:function(a,b,c){return this.vectors.length(a,b)<c},isPointInBox:function(a,b){return a.y>b.y&&a.y<b.y+b.size&&a.x>b.x&&a.x<b.x+b.size},drawPolygon:function(a,b,c,d,e,f,g){if(!(3>e)){var h=2*Math.PI/e;h=g?-h:h,a.save(),a.translate(b,c),a.rotate(f),a.moveTo(d,0);for(var i=1;e>i;i++)a.lineTo(d*Math.cos(h*i),d*Math.sin(h*i));a.closePath(),a.restore()}},timeFromMs:function(a){function b(a){return 10>a?"0"+a:a}var c=moment.duration(a),d=b(c.minutes()),e=b(c.seconds());return d+":"+e},vectors:{difference:function(a,b){return{x:b.x-a.x,y:b.y-a.y}},length:function(a,b){return b&&(a=this.difference(a,b)),Math.sqrt(a.x*a.x+a.y*a.y)},normalize:function(a,b){var c=this.difference(a,b),d=this.length(c);return{x:c.x/d,y:c.y/d}},angleTo:function(a){return Math.atan2(a.y,a.x)},getCuadraticCoef:function(a,b){return(a.y-b.y)/Math.pow(a.x-b.x,2)}},angleToDeg:function(a){return 180*a/Math.PI},angleToRad:function(a){return a*Math.PI/180},getCenter:function(a){var b=a.get("position"),c=a.get("size");return{x:b.x+c.width/2,y:b.y+c.height/2}},random11:function(){return Math.random()>.5?1:-1},getCircleCollisionBounce:function(a,b){var c=this.getCenter(a),d=this.getCenter(b),e=a.get("size"),f=b.get("size"),g=a.get("velocity")||{x:1,y:1},h=b.get("velocity")||{x:1,y:1},i={x:c.x,y:c.y,vx:g.x,vy:g.y,w:e.width,h:e.height,radius:a.get("collision"),mass:a.get("mass")||a.get("collision")},j={x:d.x,y:d.y,vx:h.x,vy:h.y,w:f.width,h:f.height,radius:b.get("collision"),mass:b.get("mass")||b.get("collision")||1},k=i.vx-j.vx,l=i.vy-j.vy,m=(i.vx*(i.mass-j.mass)+2*j.mass*j.vx)/(i.mass+j.mass),n=(i.vy*(i.mass-j.mass)+2*j.mass*j.vy)/(i.mass+j.mass),o=k+m,p=l+n,q=(i.x+j.x)/2,r=(i.y+i.y)/2,s=Math.sqrt(Math.pow(i.x-j.x,2)+Math.pow(i.y-j.y,2));return i.x=q+i.radius*(i.x-j.x)/s,i.y=r+i.radius*(i.y-j.y)/s,j.x=q+j.radius*(j.x-i.x)/s,j.y=r+j.radius*(j.y-i.y)/s,i.x-=i.w/2,i.y-=i.h/2,j.x-=j.w/2,j.y-=j.h/2,i.vx=m,i.vy=n,j.vx=o,j.vy=p,{a:i,b:j}},applyCircleCollisionBounce:function(a,b){var c=this.getCircleCollisionBounce(a,b);a.set("position",{x:c.a.x,y:c.a.y}),b.set("position",{x:c.b.x,y:c.b.y}),a.set("velocity",{x:c.a.vx,y:c.a.vy}),b.set("velocity",{x:c.b.vx,y:c.b.vy})},colors:{hsl_col_perc:function(a,b,c){var d=a,e=c*d,f=e+b;return"hsl("+f+",100%,50%)"},rgb_col_perc:function(a){return 0===a?[255,255,255]:[255*a/100,0,0]},rgb_fade:function(a,b,c){var d=b[0]-a[0],e=b[1]-a[1],f=b[2]-a[2];return[d*c+a[0],e*c+a[1],f*c+a[2]]}}}},"index.js":function(a,b,c){var d=c("./loader"),e=c("./builder"),f=c("./controls/mouse");$(function(){window.mumps={repository:c("./repository"),settings:c("./settings"),Controls:f,helpers:c("./helpers"),manager:c("./manager")},mumps.manager.showLoadingScreen(),d.initResources(mumps.settings.images).on("error",function(a){window.console.log(a)}).on("report",function(a){mumps.manager.loadProgress(a)}).on("complete",function(){$("#loading .play").show()}).load(),$("#guide .play").on("click",function(){mumps.game=e,mumps.manager.showGame(),mumps.manager.showChapterPresentation(1),mumps.finished=function(){mumps._current.stop(),mumps.manager.show(mumps._current)}}),$("#loading .play").on("click",function(){mumps.manager.showGuide()}),$(mumps.manager).on("advancelevel",function(a,b){mumps._current&&mumps._current.destroy(),mumps._current=mumps.game(b)})})},"loader.js":function(a,b){function c(){!g&&f>=100&&(g=!0,e.complete())}function d(){e.report(f)}var e={complete:function(){},report:function(){},error:function(){}},f=0,g=!1;b.exports={initResources:function(a){return mumps.repository.addResources(a).on("error",e.error).on("report",function(a){f=a,d(),c()}).on("complete",c),this},on:function(a,b){return e[a]&&(e[a]=b),this},load:function(){mumps.repository.load()}}},"manager.js":function(a,b){var c=10;b.exports={show:function(a){var b=this;$("#cinema .state").html(this.getCinemaHTML(a.level)),$("#cinema").show(),$(".next","#cinema").on("click",function(){$("#cinema").hide(),b.showChapterPresentation(a.level+1)})},clear:function(){$("#cinema .state").empty()},showGuide:function(){$("#loading").hide(),$("#guide").show()},showGame:function(){$("#guide").hide(),$("canvas").show()},showLoadingScreen:function(){$("#loading, #guide").height($(window).height()-c),$("#loading, #guide, .main").width($(window).width()-c),$("canvas").hide(),$("#loading").show()},loadProgress:function(a){$("#prg","#loading").css("width",a+"%")},showChapterPresentation:function(a){var b=this,d={1:"Revelations",2:"Realization",3:"Panic",4:"Perseverance",5:"Reunion"};$("canvas").hide(),a>=6?($("#chapter h1").text("THE END"),$("#chapter h2").text("You have safetly survived to the mumps infection ... so far"),$("#chapter a.continue").text("Restart")):($("#chapter h1").text("CHAPTER "+a),$("#chapter h2").text(d[a]),$("#chapter a.continue").text("Continue >")),$("#chapter").height($(window).height()-c),$("#chapter, .main").width($(window).width()-c),$("#chapter").show(),$("#chapter a.continue").on("click",function(){$("canvas").show(),$("#chapter").hide(),a>=6?$(b).trigger("advancelevel",1):$(b).trigger("advancelevel",a)})},getCinemaHTML:function(a){var b={1:["<p>Why the heck she is not here? What does this note mean?:</p>"," <quote><p>Chimataru: I still don't understand why you keep doing always the same thing.</p>"," <p>Plus these strange mumps keep propagating in this sh***y town. I don't feel like sitting"," here for you. I went out with the girls into another bar. </p></quote> <p>Signed - lilita</p>"].join(""),2:["<p>I felt strange for a bit. </p><p>I'm starting to think "," these mumps are not yet another media invention.</p>","<p>If all of this is really happening I want to be with her.</p>","<p>I know this is my last chance</p>"].join(""),3:["<p><label>Chimataru:</label><span>hey, why are you blocking the street?</span></p>","<p><label>Unknown human:</label><span>I won't let them come. The mumps are contagious and stronger in the other side</span></p>","<p><label>Chimataru:</label><span>I don't care. Goodbye sir</span></p>"],4:["<p>People is not being polite. Not at all. They keep pushing me.</p> <p>However, I feel ready for this.</p>"],5:["<p><label>Chimataru:</label><span>I've made impossible things to get to you.</span></p>","<p><label>Lilita:</label><span>I'm really sorry. I regret those silly discussions and life-wasting angry moments.</span></p>","<p>Just let's enjoy. <b>You only get one life.</b></p>"]};return b[a]},showGameOver:function(a){var b=this;$("#gameover").show(),$(".retry","#gameover").on("click",function(){$("#gameover").hide(),$(b).trigger("advancelevel",a)})}}},"repository.js":function(a,b){b.exports=function(){var a={},b=0,c=function(){return Object.keys(a).length},d={complete:function(){},report:function(){},error:function(){}},e=function(){var a=c(),e=100*++b/a;a>=b&&(d.report(e),e>=100&&d.complete())},f=function(a,b){d.error(a,b)};return{on:function(a,b){return d[a]&&(d[a]=b),this},loadOne:function(b,c,d){var e=c||function(){},f=d||function(){};if(!b)throw"Parameter 'name' not specify";if(!a[b])throw"Resource "+b+" not found!. Use addReource() before load.";return this[b]=new window.Image,this[b].onload=e,this[b].onerror=f,this[b].src=a[b],this},load:function(){b=0;for(var c in a)a.hasOwnProperty(c)&&(this[c]=new window.Image,this[c].onload=e,this[c].onerror=f,this[c].src=a[c]);return this},addResources:function(b){for(var c in b)if(b.hasOwnProperty(c)){if(a.hasOwnProperty(c))throw"The resource "+c+" already exists.";a[c]=b[c]}return this},clear:function(){var b=c();do this[a[b]]&&(this[a[b]]=null,delete this[a[b]]);while(b--);a={}}}}()},"settings.js":function(a,b){b.exports={debug:!1,worldSize:{w:2e3,h:2e3},images:{chapter_bg:"images/chapter_bg.png",guide:"images/guide.gif",person:"images/person.png",bar:"images/bar.png",bar_floor:"images/bar_floor.png",street:"images/street.png",street_floor:"images/street_bg.png",hud:"images/face.png"},infection:{initialInfections:1,maxExposureTime:1,exposureCooldown:3,contagionRadius:150,contagionPower:.5},defaultPersonSpeed:1.5,defaultNPCRest:[0,1]}},spriteSheets:{"bar.js":function(a,b){b.exports={resource:"bar",animations:{barra:[{x:0,y:0,w:208,h:630}],table:[{x:210,y:0,w:380,h:190}],table_vertical:[{x:590,y:0,w:190,h:380}],stand_table:[{x:210,y:450,w:335,h:125}],stand_table_vertical:[{x:590,y:380,w:125,h:335}],beer:[{x:490,y:190,w:65,h:70}],beer_split1:[{x:210,y:190,w:150,h:120}],beer_split2:[{x:360,y:190,w:150,h:120}],letter:[{x:210,y:310,w:125,h:140}]}}},"hud.js":function(a,b){b.exports={resource:"hud",animations:{infection_bar1:[{x:0,y:0,w:250,h:250}],infection_bar2:[{x:250,y:0,w:250,h:250}],infection_bar3:[{x:500,y:0,w:250,h:250}],infection_bar4:[{x:750,y:0,w:250,h:250}],infection_bar5:[{x:1e3,y:0,w:250,h:250}]}}},"index.js":function(a,b,c){b.exports={person:c("./person")(),bar:c("./bar"),street:c("./street"),hud:c("./hud")}},"person.js":function(a,b){b.exports=function(){for(var a=100,b=150,c={resource:"person",animations:{}},d=0;6>=d;d++){c.animations["idle_"+d]=[{x:0,y:b*d,w:a,h:b}],c.animations["walking_"+d]=[];for(var e=1;5>=e;e++)3!==e&&c.animations["walking_"+d].push({x:a*e,y:b*d,w:a,h:b})}return c}},"street.js":function(a,b){b.exports={resource:"street",animations:{awning:[{x:0,y:0,w:545,h:240}],awning_upsidedown:[{x:0,y:800,w:545,h:240}],car:[{x:545,y:0,w:625,h:290}],trash:[{x:540,y:290,w:500,h:360}],fence:[{x:540,y:650,w:100,h:180}]}}}},systems:{"Animations.js":function(a,b,c){var d=c("../spriteSheets");b.exports=oaky.System.extend({uses:["display"],initialize:function(){},process:function(a,b){for(var c=this.game.gameTime.lastTime,d=0;d<b.length;d++){var e=b[d],f=e.get("display");if(f.hasOwnProperty("type"))this.updateAnimation(f,c);else for(var g in f)f.hasOwnProperty(g)&&this.updateAnimation(f[g],c)}},updateAnimation:function(a,b){if("sprite"===a.type){var c=d[a.sheet],e=c.animations[a.animation];e&&e.length>1?(a.frameTime?(!a.lastFrameTime||a.lastFrameTime&&b-a.lastFrameTime>a.frameTime)&&(a.index++,a.lastFrameTime=new Date):a.index++,a.index>=e.length&&(a.index=0,a.loop||(a.animation="idle"))):a.index=0}}})},"Boundaries.js":function(a,b){b.exports=oaky.System.extend({uses:["position","size","boundary"],initialize:function(){},process:function(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.get("position"),f=!1,g=!1,h=d.get("boundary"),i=h.min,j=h.max;e.x<i.x?(e.x=i.x,f=!0):e.x>j.x&&(e.x=j.x,f=!0),e.y<i.y?(e.y=i.y,g=!0):e.y>j.y&&(e.y=j.y,g=!0),(f||g)&&(d.remove("target"),d.has("velocity")&&(d.set("velocity",{x:0,y:0}),d.is("person")&&(d.get("display").animation="idle_"+d.get("skin"),d.get("display").index=0)),d.set("position",e))}}})},"Camera.js":function(a,b){b.exports=oaky.System.extend({uses:[],initialize:function(a){this.follow=a.follow,this.min=a.min,this.max=a.max},process:function(){var a=this.game.camera.get("position"),b=this.game.camera.get("size"),c=this.follow.get("position");a.x=c.x-b.width/2,a.y=c.y-b.height/2,a.x<this.min.x&&(a.x=this.min.x),a.y<this.min.y&&(a.y=this.min.y),a.x>this.max.x-b.width&&(a.x=this.max.x-b.width),a.y>this.max.y-b.height&&(a.y=this.max.y-b.height),this.game.camera.set("position",a)}})},Collision:{"Objetive.js":function(a,b){b.exports=oaky.System.extend({uses:[],initialize:function(){},process:function(){var a=this.game.player;if(a.is("player")){var b=this.game.objetive,c=mumps.helpers.isNear(a,b,500)&&mumps.helpers.entitiesCollide(a,b)?!0:!1;c&&(mumps._current.controls.disable(),mumps.finished(),this.enabled=!1)}}})},"People.js":function(a,b){b.exports=oaky.System.extend({uses:["person","collision"],initialize:function(){},process:function(a,b){for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<b.length;e++){var f=b[e];if(f.id!==d.id){var g=mumps.helpers.isNear(d,f,200)&&mumps.helpers.entitiesCollide(d,f)?!0:!1;g&&(d.get("position").x-=d.get("velocity").x,d.get("position").y-=d.get("velocity").y,f.get("position").x-=f.get("velocity").x,f.get("position").y-=f.get("velocity").y,d.remove("target"),f.remove("target"),d.get("display").animation="idle_"+d.get("skin"),d.get("display").index=0,f.get("display").animation="idle_"+f.get("skin"),f.get("display").index=0,d.is("player")&&d.set("velocity",{x:0,y:0}),f.is("player")&&f.set("velocity",{x:0,y:0}))}}}})},"PeopleObstacles.js":function(a,b){b.exports=oaky.System.extend({uses:["person","collision"],initialize:function(){},process:function(a,b){for(var c=this.game.entities.get("obstacle"),d=0;d<b.length;d++)for(var e=b[d],f=0;f<c.length;f++){var g=c[f],h=this.checkCollision(e,g)?!0:!1;h&&(e.remove("target"),e.get("display").animation="idle_"+e.get("skin"),e.get("display").index=0,e.is("player")&&e.set("velocity",{x:0,y:0}))}},checkCollision:function(a,b){var c=mumps.helpers.getCenter(a),d={x:c.x,y:c.y,r:a.get("collision")},e={x:b.get("position").x,y:b.get("position").y,width:b.get("size").width,height:b.get("size").height},f=mumps.helpers.circleRectangleCollide(d,e);return f&&(a.get("position").x-=a.get("velocity").x,a.get("position").y-=a.get("velocity").y),f}})}},"Contagion.js":function(a,b){b.exports=oaky.System.extend({uses:["contagionFocus"],MAX_TIME_EXPOSED:mumps.settings.infection.maxExposureTime,initialize:function(){},process:function(a,b){for(var c=0;c<b.length;c++)for(var d=b[c],e=d.get("contagionFocus"),f=this.game.entities.get("person"),g=0;g<f.length;g++){var h=f[g];h.has("contagionFocus")||h.is("inmune")||mumps.helpers.isNear(d,h,e.radius)&&(h.has("infectionProgress")?h.get("infectionProgress").timeExposed-=a/1e3:h.set("infectionProgress",{progress:.01,timeExposed:this.MAX_TIME_EXPOSED-.01}))}},_contagionCalc:function(){}})},"Facing.js":function(a,b){b.exports=oaky.System.extend({uses:["target","angle"],initialize:function(){},process:function(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=mumps.helpers.getCenter(d),f=d.get("target"),g=mumps.helpers.vectors.difference(e,f),h=mumps.helpers.vectors.angleTo(g),i=d.get("angle");if(h!==i){if(d.is("spinning")){var j=d.get("spinning");i+=j,d.set("angle",i)}var k=this.getShortestArc(i,h);Math.abs(k)<.2?(d.remove("spinning"),d.set("angle",h)):d.is("spinning")||(k>i?d.add("spinning",.2):d.add("spinning",-.2))}}},getShortestArc:function(a,b){var c=Math.PI;return Math.abs(b-a)<c?b-a:b>a?b-a-2*c:b-a+2*c}})},Factory:{"Obstacles.js":function(a,b,c){var d=c("../../entities/obstacle"),e=c("../../data/index");b.exports=oaky.System.extend({uses:["obstacle"],initialize:function(){},process:function(a,b){var c=e[this.game.level].obstacles;b.length<c.length&&_.times(c.length,function(a){var b=_.defaults(c[a],{spriteSheet:e[this.game.level].spriteSheet});d(this.game,b)},this)}})}},"GameOverMumped.js":function(a,b){b.exports=oaky.System.extend({uses:["contagionFocus","player"],initialize:function(){this.timeAfterMumps=2,this.lost=!1},process:function(a,b){var c=a/1e3;b.length>0&&(this.lost=!0,b[0].remove("player"),b[0].add("npc",{rest:[0,0]}),b[0].set("speed",10)),this.lost&&(this.timeAfterMumps<=0?(mumps.manager.showGameOver(this.game.level),this.enabled=!1):this.timeAfterMumps-=c)},_contagionCalc:function(){}})},HUD:{"PlayerStatus.js":function(a,b,c){var d=c("../../spriteSheets/hud");b.exports=oaky.System.extend({uses:["display","playerStatus"],initialize:function(){},process:function(a,b){for(var c=this.game.player.has("infectionProgress")?this.game.player.get("infectionProgress").progress:this.game.player.has("contagionFocus")?100:0,e=_.keys(d.animations).length,f=1/e,g=0;g<b.length;g++){for(var h=b[g],i=0,j=1,k=mumps.helpers.colors.rgb_fade([255,255,255],[255,102,51],c),l=0;e>l&&c>i;l++)j=l+1,i+=f;h.get("display").animation="infection_bar"+j,h.get("display").replaceColor={from:[255,255,255],to:k,tolerance:100}}}})}},"Infection.js":function(a,b){b.exports=oaky.System.extend({uses:["infectionProgress"],EXPOSURE_COOLDOWN:mumps.settings.infection.exposureCooldown,MAX_TIME_EXPOSED:mumps.settings.infection.maxExposureTime,initialize:function(){},process:function(a,b){for(var c=0;c<b.length;c++){for(var d=b[c],e=this.game.entities.get("contagionFocus"),f=!1,g=null,h=0;h<e.length;h++){var i=e[h];if(mumps.helpers.isNear(d,i,i.get("contagionFocus").radius)){f=!0,g=i.get("contagionFocus").power;break}}f?this._updateInfectionPercentage(d,a,"timeExposed",g):(this._decreaseInfection(d,a),this._updateInfectionPercentage(d,a,"cooldown")),this._updateSickStatus(d)}},_decreaseInfection:function(a,b){var c=a.get("infectionProgress");c.exposureTime=0,c.cooldown?c.cooldown-=b/1e3:c.cooldown=this.EXPOSURE_COOLDOWN*c.progress},_contagionCalc:function(){},_updateInfectionPercentage:function(a,b,c,d){a.get("infectionProgress").progress="cooldown"===c?a.get("infectionProgress")[c]/this.EXPOSURE_COOLDOWN:(d||1)*(1-a.get("infectionProgress")[c])/this.MAX_TIME_EXPOSED
},_updateSickStatus:function(a){var b=a.get("infectionProgress");b.progress<=0?a.remove("infectionProgress"):b.progress>=1&&(a.remove("infectionProgress"),a.add("contagionFocus",{radius:mumps.settings.infection.contagionRadius,power:mumps.settings.infection.contagionPower}))}})},"Movement.js":function(a,b){b.exports=oaky.System.extend({uses:["position","velocity","speed"],initialize:function(){},process:function(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.get("position");if(d.is("spinning"))d.set("velocity",{x:0,y:0});else if(d.has("target")){var f=mumps.helpers.getCenter(d),g=mumps.helpers.vectors.length(f,d.get("target")),h=10>g?!0:!1;if(h){if(d.get("display").animation="idle_"+d.get("skin"),d.get("display").index=0,d.remove("target"),d.set("velocity",{x:0,y:0}),d.is("npc")){var i=d.get("npc").rest;d.set("rest",_.random(i[0],i[1]))}}else{d.get("display").animation.indexOf("idle")>-1&&(d.get("display").animation="walking_"+d.get("skin"),d.get("display").index=0);var j=mumps.helpers.vectors.normalize(f,d.get("target"));d.set("velocity",{x:j.x*d.get("speed"),y:j.y*d.get("speed")})}}var k=d.get("velocity");e.x+=k.x,e.y+=k.y,d.set("position",e)}}})},Renderer:{"Dynamic.js":function(a,b,c){var d=c("./index"),e=c("../../data/index"),f=b.exports=d.extend({uses:["display","dynamic","position"],initialize:function(){this._super(f,arguments),this.bg=null},process:function(a,b){var c,d=this.ctx,e=this.game.camera.get("position").x,f=this.game.camera.get("position").y;for(d.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBackground(),b.sort(function(a,b){return(a.get("zindex")||0)-(b.get("zindex")||0)}),c=0;c<b.length;c++){var g=b[c];g.has("particles")&&g.has("particlesBack")&&(d.save(),this.drawParticles(g,e,f),d.restore());var h=g.get("position"),i=g.get("size"),j=i.width||2*i.radius,k=i.height||2*i.radius,l=h.x+j/2,m=h.y+k/2;d.save(),d.translate(l-e,m-f),l=-j/2,m=-k/2,this.processDisplays(g,l,m),d.restore(),g.has("particles")&&!g.has("particlesBack")&&(d.save(),this.drawParticles(g,e,f),d.restore()),mumps.settings.debug&&this.drawDebug(g,e,f,h,i)}},drawBackground:function(){var a=this.ctx,b=this.game.camera.get("position"),c=this.game.camera.get("size"),d=-Math.round(b.x),f=-Math.round(b.y);if(a.save(),a.rect(0,0,c.width,c.height),!this.bg){var g=mumps.repository[e[this.game.level].background||"bar_floor"];this.bg=this.ctx.createPattern(g,"repeat")}a.fillStyle=this.bg,a.translate(d,f),a.fill(),a.restore()},drawParticles:function(a,b,c){var d=this.ctx,e=a.get("particles");for(var f in e)if(e.hasOwnProperty(f))for(var g=e[f].pool,h=0;h<g.length;h++){var i=g[h];i.life>0&&i.color&&(d.beginPath(),d.arc(i.x-b,i.y-c,i.radius*i.scale,0,2*Math.PI),d.fillStyle="rgba("+i.color[0]+","+i.color[1]+","+i.color[2]+","+i.color[3]+")",d.fill())}},drawDebug:function(a,b,c,d,e){var f=this.ctx,g=mumps.helpers.getCenter(a);if(a.has("collision")){var h=a.get("collision");f.beginPath(),f.arc(g.x-b,g.y-c,h,0,2*Math.PI,!1),f.strokeStyle="orange",f.lineWidth=3,f.stroke()}if(f.beginPath(),f.rect(d.x-b,d.y-c,e.width,e.height),a.has("infectionProgress")){var i=a.get("infectionProgress").progress;f.strokeStyle=mumps.helpers.colors.hsl_col_perc(1-i,0,100),f.fillStyle=mumps.helpers.colors.hsl_col_perc(1-i,0,100),f.fill()}else f.strokeStyle="red";if(f.lineWidth=3,f.stroke(),a.has("boundary")&&a.get("boundary").min.x>0){var j=a.get("boundary"),k=j.min.x-b,l=j.min.y-c,m=j.max.x-j.min.x,n=j.max.y-j.min.y;f.beginPath(),f.rect(k,l,m,n),f.strokeStyle="#c3f4ba",f.lineWidth=3,f.stroke()}if(a.has("contagionFocus")){var o=a.get("contagionFocus").radius;f.beginPath(),f.arc(g.x-b,g.y-c,o,0,2*Math.PI,!1),f.strokeStyle="green",f.lineWidth=2,f.stroke()}},draw_line:function(a,b){var c=this.ctx,d=this.game.camera.get("position").x,e=this.game.camera.get("position").y,f=a.get("position").x-d,g=a.get("position").y-e,h=a.get("target").x-d,i=a.get("target").y-e;c.strokeStyle=b.color,c.beginPath(),c.moveTo(f,g),c.lineTo(h,i),c.lineWidth=b.width,c.closePath(),c.stroke()}})},"Static.js":function(a,b,c){var d=c("./index"),e=b.exports=d.extend({uses:["display","static"],initialize:function(){this._super(e,arguments)},process:function(a,b){var c,d=this.ctx;for(d.clearRect(0,0,this.canvas.width,this.canvas.height),b.sort(function(a,b){return(a.get("zindex")||0)-(b.get("zindex")||0)}),c=0;c<b.length;c++){var e=b[c],f=e.get("position"),g=f.x,h=f.y;d.save(),this.processDisplays(e,g,h),d.restore()}},draw_line:function(a,b){var c=this.ctx,d=b.from.x,e=b.from.y,f=b.to.x,g=b.to.y;if(b.colorStop){for(var h=c.createLinearGradient(d,e,f,g),i=0;i<b.colorStop.length;i++){var j=b.colorStop[i];h.addColorStop(j.p,j.c)}c.strokeStyle=h}c.beginPath(),c.moveTo(d,e),c.lineTo(f,g),c.lineWidth=b.width,c.closePath(),c.stroke()}})},"index.js":function(a,b,c){var d=c("../../spriteSheets");b.exports=oaky.System.extend({uses:["display"],initialize:function(a){this.canvas=a.canvas,this.ctx=this.canvas.getContext("2d")},process:function(){},processDisplays:function(a,b,c){var d=this.ctx;if(a.has("angle")){var e=a.get("angle");d.rotate(e)}if(a.has("scale")){var f=a.get("scale");d.scale(f.x,f.y)}var g=a.get("display");if(g.hasOwnProperty("type")&&!g.hidden)d.save(),this["draw_"+g.type](a,g,b,c),d.restore();else if(!g.hidden)for(var h in g)g.hasOwnProperty(h)&&!g[h].hidden&&(d.save(),this["draw_"+g[h].type](a,g[h],b,c),d.restore())},draw_circle:function(a,b,c,d){var e=this.ctx;c+=b.x||0,d+=b.y||0;var f=b.radius||1;e.beginPath(),e.arc(c,d,f,0,2*Math.PI,!1);var g=!1;b.strokeColor&&(e.strokeStyle=b.strokeColor,g=!0),b.strokeWidth&&(e.lineWidth=b.strokeWidth,g=!0),g&&e.stroke();var h=!1;b.fillColor&&(e.fillStyle=b.fillColor,h=!0),h&&e.fill()},draw_line:function(){},draw_rect:function(a,b,c,d){var e=this.ctx,f=b.width||a.get("size").width||50,g=b.height||a.get("size").height||50;c+=b.x||0,d+=b.y||0,e.beginPath(),e.rect(c,d,f,g),b.strokeColor&&(e.strokeStyle=b.strokeColor||"black",e.lineWidth=b.strokeWidth||1,e.stroke()),b.fill&&(e.fillStyle=b.fill,e.fill())},draw_text:function(a,b,c,d){var e=this.ctx;c+=b.x||0,d+=b.y||0,e.font=b.font,e.fillStyle=b.color,e.fillText(b.text,c,d)},draw_sprite:function(a,b,c,e){var f=this.ctx,g=b.width,h=b.height;c+=b.x||0,e+=b.y||0;var i=d[b.sheet],j=window.mumps.repository[i.resource],k=i.animations[b.animation];if(k){var l=k[b.index];if(b.angle&&(f.translate(c+g/2,e+g/2),c=-g/2,e=-h/2,f.rotate(b.angle)),b.opacity&&(f.globalAlpha=b.opacity),b.replaceColor){var m=b.replaceColor.from,n=b.replaceColor.to,o=b.replaceColor.tolerance||0,p=this.recolorImage(j,m[0],m[1],m[2],n[0],n[1],n[1],o);f.drawImage(p.canvas,l.x,l.y,l.w,l.h,c,e,g,h)}else f.drawImage(j,l.x,l.y,l.w,l.h,c,e,g,h)}},draw_pattern:function(){},recolorImage:function(a,b,c,d,e,f,g,h){var i=document.createElement("canvas"),j=i.getContext("2d"),k=a.width,l=a.height;i.width=k,i.height=l;var m=function(a,b,c){return c>=a-b&&a+b>=c};j.drawImage(a,0,0,k,l);for(var n=j.getImageData(0,0,k,l),o=0;o<n.data.length;o+=4)m(n.data[o],h,b)&&m(n.data[o+1],h,c)&&m(n.data[o+2],h,d)&&(n.data[o]=e,n.data[o+1]=f,n.data[o+2]=g);return j.putImageData(n,0,0),j}})}},"Rest.js":function(a,b){b.exports=oaky.System.extend({uses:["rest"],initialize:function(){},process:function(a,b){for(var c=a/1e3,d=0;d<b.length;d++){var e=b[d];e.set("rest",e.get("rest")-c),e.get("rest")<=0&&e.remove("rest")}}})},"WalkControl.js":function(a,b){b.exports=oaky.System.extend({uses:[],initialize:function(){},process:function(){var a=mumps.helpers.getCenter(this.game.player),b=this.game.walkLine;if(b.has("walkStartingPoint")){var c=b.get("walkStartingPoint"),d=mumps.helpers.isPointInCircle(c,a,this.game.player.get("collision"));d?b.set("position",c):b.remove("position")}}})},"iaNPC.js":function(a,b){b.exports=oaky.System.extend({uses:["npc"],initialize:function(){},process:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(!d.has("target")&&!d.has("rest")){var e=d.get("position"),f=_.random(0,360),g=_.random(30,500),h={x:g*Math.cos(f),y:g*Math.sin(f)};d.set("target",{x:h.x+e.x,y:h.y+e.y})}}}})},"index.js":function(a,b,c){b.exports=function(a){var b={};b.camerasAndFacing={camera:c("./Camera").create({follow:a.player,min:{x:0,y:0},max:{x:mumps.settings.worldSize.w,y:mumps.settings.worldSize.h}}),facing:c("./Facing").create()},b.movement={iaNPC:c("./iaNPC").create(),movement:c("./Movement").create(),rest:c("./Rest").create()},b.collisions={peopleCollision:c("./Collision/People").create(),peopleObstaclesCollision:c("./Collision/PeopleObstacles").create(),objetiveCollision:c("./Collision/Objetive").create()},b.contagion={contagion:c("./Contagion").create(),infection:c("./Infection").create(),gameOverMumped:c("./GameOverMumped").create()},b.controls={walkControl:c("./WalkControl").create({player:a.player})},b.animations={animations:c("./Animations").create()},b.factories={obstaclesFactory:c("./Factory/Obstacles").create()},b.bounds={boundaries:c("./Boundaries").create()},b.HUD={playerStatus:c("./HUD/PlayerStatus").create()},b.rendering={rendererDynamic:c("./Renderer/Dynamic").create({canvas:a.canvas}),rendererStatic:c("./Renderer/Static").create({canvas:a.canvasStatic})};var d=["camerasAndFacing","controls","animations","factories","contagion","collisions","movement","bounds","HUD","rendering"];_.each(d,function(c){_.each(b[c],function(b,c){a.addSystem(c,b)})})}}}}}}})("ld28/client/game/index"),window.base={root:"http://localhost:3000"};